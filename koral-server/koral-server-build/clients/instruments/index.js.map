{"version":3,"names":["Client","loadConfig","launcher","render","html","literal","instrumentsViews","kmove","kgesture","kbutton","klav","kpad","kord","settingsData","kantizer","legato","bolt","move","settings","instrumentsSchemaData","octava","range","window","sendEvent","key","value","console","log","toggleModal","setModal","main","$container","config","client","register","initScreensContainer","start","queryParams","URLSearchParams","location","search","instrument","get","id","initModal","data","instrumentState","stateManager","create","viewTagName","onUpdate","updates","Object","entries","renderApp","settingsDisplay","includes","execute","numClients","parseInt"],"sources":["../../../src/clients/instruments/index.js"],"sourcesContent":["import '@soundworks/helpers/polyfills.js';\nimport { Client } from '@soundworks/core/client.js';\nimport { loadConfig, launcher } from '@soundworks/helpers/browser.js';\nimport { render } from 'lit';\nimport { html, literal } from 'lit/static-html.js';\n\nimport './views/shared/koral-footer.js';\nimport './views/shared/koral-header.js';\nimport './views/shared/koral-not-found.js';\nimport './views/shared/koral-settings.js';\n\nimport './views/koral-kbutton.js';\nimport './views/koral-kgesture.js';\nimport './views/koral-klav.js';\nimport './views/koral-kmove.js';\nimport './views/koral-kord.js';\nimport './views/koral-kpad.js';\n\n// - General documentation: https://soundworks.dev/\n// - API documentation:     https://soundworks.dev/api\n// - Issue Tracker:         https://github.com/collective-soundworks/soundworks/issues\n// - Wizard & Tools:        `npx soundworks`\n\nconst instrumentsViews = {\n  kmove: literal`koral-kmove`,\n  kgesture: literal`koral-kgesture`,\n  kbutton: literal`koral-kbutton`,\n  klav: literal`koral-klav`,\n  kpad: literal`koral-kpad`,\n  kord: literal`koral-kord`,\n};\n\nconst settingsData = {\n  kantizer: false,\n  legato: false,\n  bolt: false,\n  move: false,\n};\n\nconst settings = settingsData;\nconst instrumentsSchemaData = {\n  kmove: {\n    settings,\n  },\n  kgesture: {\n    settings,\n  },\n  kbutton: {\n    settings,\n  },\n  klav: {\n    settings,\n    octava: 3,\n  },\n  kpad: {\n    settings,\n    range: 3,\n    octava: 3,\n  },\n  kord: {\n    settings,\n    octava: 3,\n  },\n};\n\n// for debug\nif (!window.sendEvent) {\n  window.sendEvent = (key, value) => console.log(key, value);\n  window.toggleModal = value => console.log('toggleModal');\n  window.setModal = value => console.log('setModal')\n  // debug\n  window.log = value => console.log(value);\n}\n\nasync function main($container) {\n  const config = loadConfig();\n  const client = new Client(config);\n  launcher.register(client, { initScreensContainer: $container });\n\n  await client.start();\n\n  // configure view according to given query parameters\n  const queryParams = new URLSearchParams(window.location.search);\n  const instrument = queryParams.get('instrument');\n  const id = queryParams.get('id');\n  const initModal = queryParams.get('fullscreen');\n  // @todo - should contain initial settings too\n  console.log(instrument, id, initModal);\n\n  const data = instrumentsSchemaData[instrument];\n\n  // @todo - get shared state for infos feedback\n  const instrumentState = await client.stateManager.create('instrument', { id, instrument, data });\n\n\n  let viewTagName = null;\n  instrumentState.onUpdate(updates => {\n    for (let [key, value] of Object.entries(updates)) {\n      switch (key) {\n        case 'instrument': {\n          viewTagName = (instrument in instrumentsViews)\n            ? instrumentsViews[instrument]\n            : literal`koral-not-found`;\n          break;\n        }\n      }\n    }\n    renderApp();\n  }, true)\n\n  function renderApp() {\n    const settingsDisplay = instrumentState.get('settings');\n    render(html`\n          <div class=\"screen ${['kmove', 'kgesture'].includes(instrument) ? 'bg2': 'bg'}\" id=\"main\" style=\"${settingsDisplay ? 'display: none' : ''}\">\n            <koral-header\n              id=${id}\n              instrument=${instrument}\n              infos=${instrumentState.get('infos')}\n            ></koral-header>\n            <${viewTagName} class=\"instrument\"\n              instrument=${instrument}\n              ?freeze=${instrumentState.get('freeze')}\n              .state=${instrumentState}\n            ></${viewTagName}>\n            <koral-footer\n              .state=${instrumentState}\n            ></koral-footer>\n          </div>\n          <div class=\"screen bg\" id=\"main\" style=\"${settingsDisplay ? '': 'display: none'}\">\n            <koral-settings\n              id=${id}\n              instrument=${instrument}\n              infos=${instrumentState.get('infos')}\n              .state=${instrumentState}\n            ></koral-settings>\n          </div>`,\n          $container);\n  }\n}\n\n// The launcher enables instanciation of multiple clients in the same page to\n// facilitate development and testing.\n// e.g. `http://127.0.0.1:8000?emulate=10` to run 10 clients side-by-side\nlauncher.execute(main, {\n  numClients: parseInt(new URLSearchParams(window.location.search).get('emulate')) || 1,\n});\n"],"mappings":"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","ignoreList":[]}
